# [HackTheBox] Spookifier
<p>Äáº§u tiÃªn, khi nháº­p name vÃ  click vÃ o nÃºt SpookiSpookify thÃ¬ tráº£ vá» 4 font khÃ¡c nhau cá»§a input. Quan sÃ¡t URL, tháº¥y Ä‘Æ°á»£c ráº±ng input Ä‘Æ°á»£c gá»­i qua tham sá»‘ text.</p>

![alt text](/thanhlai/post/web_exploitation/image/post5/image.png)

<p>Tham sá»‘ text Ä‘Æ°á»£c Ä‘Æ°a vÃ o hÃ m spookify trong file utils.py Ä‘á»ƒ xá»­ lÃ½ vÃ  tráº£ vá» cÃ¹ng vá»›i template </p>

![alt text](/thanhlai/post/web_exploitation/image/post5/image-1.png)

<p>DÃ²ng 307 trong utils.py thá»±c hiá»‡n Ä‘Æ°a tham sá»‘ text vÃ o hÃ m change_font -> CÃ³ váº» nhÆ° hÃ m nÃ y tráº£ vá» 4 font khÃ¡c nhau cá»§a input. Cuá»‘i cÃ¹ng, tráº£ vá» káº¿t quáº£ sau khi Ä‘Æ°a 4 font Ä‘Ã³ vÃ o hÃ m generate_render.</p>

![alt text](/thanhlai/post/web_exploitation/image/post5/image-2.png)

<p>Äiá»u Ä‘áº·c biá»‡t trong 4 font nÃ y lÃ  font thá»© 4 hoÃ n toÃ n khÃ´ng thay Ä‘á»•i kÃ½ tá»± gá»‘c mÃ  giá»¯ nguyÃªn chá»¯ cÃ¡i, sá»‘ vÃ  kÃ½ tá»± Ä‘áº·c biá»‡t.</p>

![alt text](/thanhlai/post/web_exploitation/image/post5/image-6.png)

<p>HÃ m generate_render táº¡o ra má»™t template HTML vá»›i 4 font khÃ¡c nhau vÃ  tráº£ vá» káº¿t quáº£ sau khi render HTML -> Äoáº¡n code nÃ y gÃ¢y ra lá»—i SSTI vÃ¬ input cÃ³ thá»ƒ tÃ¡c dá»¥ng trá»±c tiáº¿p vÃ o template engine trÆ°á»›c khi render. VÃ¬ font thá»© 4 váº«n giá»¯ nguyÃªn giÃ¡ trá»‹ cá»§a input nÃªn cÃ³ thá»ƒ thá»±c thi code trong template.</p>

![alt text](/thanhlai/post/web_exploitation/image/post5/image-3.png)

<p>VÃ¬ trang web nÃ y sá»­ dá»¥ng template engine lÃ  Mako (dá»±a vÃ o import, Dockerfile cÃ³ sáºµn) nÃªn payload sáº½ cÃ³ dáº¡ng ${}. Thá»­ ${2 - 1} thÃ¬ káº¿t quáº£ tráº£ vá» á»Ÿ hÃ ng thá»© 4 chÃ­nh xÃ¡c lÃ  1.</p>

![alt text](/thanhlai/post/web_exploitation/image/post5/image-4.png)

<p>Payload hoÃ n chá»‰nh Ä‘á»ƒ Ä‘á»c ná»™i dung flag: ${__import__('os').popen('cat /flag.txt').read()}. DÃ¹ng __import__('os') Ä‘á»ƒ import os, rá»“i gá»i os.popen('cat /flag.txt').read() Ä‘á»ƒ thá»±c thi lá»‡nh, láº¥y ná»™i dung /flag.txt vÃ  hiá»ƒn thá»‹ ra.</p>

![alt text](/thanhlai/post/web_exploitation/image/post5/image-5.png)

<p>TÃ³m láº¡i, Ä‘Ã¢y lÃ  toÃ n bá»™ ná»™i dung vá» challenge. Hy vá»ng writeups nÃ y giÃºp Ã­ch cho báº¡n ğŸ”¥.</p>