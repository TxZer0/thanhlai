# [Intigriti] Challenge-0524
<p>Äáº§u tiÃªn, trang web nÃ y cÃ³ chá»©c nÄƒng tÃ¬m x cá»§a phÆ°Æ¡ng trÃ¬nh báº­c 2 vá»›i cÃ¡c há»‡ sá»‘ A, B, C do ngÆ°á»i dÃ¹ng nháº­p vÃ o.</p>

![alt text](/thanhlai/post/web_exploitation/image/post3/image.png)

<p>View source: nÆ¡i cáº§n chÃº Ã½ lÃ  2 dÃ²ng code sá»­ dá»¥ng echo Ä‘á»ƒ in giÃ¡ trá»‹ nghiá»‡m náº±m trong pháº§n else cÃ³ kháº£ nÄƒng bá»‹ XSS náº¿u nhÆ° káº¿t quáº£ tráº£ vá» cá»§a hÃ m calculateFormula khÃ´ng Ä‘Æ°á»£c xá»­ lÃ½ Ä‘Ãºng cÃ¡ch. Äá»‘i sá»‘ truyá»n vÃ o lÃ  biá»ƒu thá»©c tÃ­nh toÃ¡n chá»©a cÃ¡c giÃ¡ trá»‹ há»‡ sá»‘ nháº­n tá»« user input.</p>

![alt text](/thanhlai/post/web_exploitation/image/post3/image-1.png)

<p>Báº¯t Ä‘áº§u tÃ¬m hiá»ƒu sÆ¡ lÆ°á»£c vá» hÃ m calculateFormula trong lá»›p Calculation. Báº±ng cÃ¡ch search Ä‘Æ°á»ng dáº«n "PhpOffice\PhpSpreadsheet\Calculation\Calculation" Ä‘Æ°á»£c khai bÃ¡o trong PHP thÃ¬ mÃ¬nh Ä‘Ã£ tÃ¬m ra file Calculation.php á»Ÿ trÃªn github. Tuy nhiÃªn, chÆ°a rÃµ version chÃ­nh xÃ¡c cá»§a Calculation.php mÃ  web nÃ y sá»­ dá»¥ng. Thá»­ sá»­ dá»¥ng chá»©c nÄƒng blame cá»§a github thÃ¬ mÃ¬nh phÃ¡t hiá»‡n ra ráº±ng háº§u nhÆ° táº¥t cáº£ cÃ¡c dÃ²ng code trong file nÃ y Ä‘á»u Ä‘Æ°á»£c update gáº§n Ä‘Ã¢y nháº¥t lÃ  2 nÄƒm trÆ°á»›c. MÃ  hiá»‡n táº¡i lÃ  Ä‘áº§u nÄƒm 2025 nÃªn khÃ´ng cáº§n pháº£i quan tÃ¢m vá» version ná»¯a.</p>

![alt text](/thanhlai/post/web_exploitation/image/post3/image-2.png)

<p>Biá»ƒu thá»©c chá»‰ Ä‘Æ°á»£c dÃ¹ng duy nháº¥t táº¡i dÃ²ng 365 Ä‘á»ƒ tráº£ vá» káº¿t quáº£ sau khi tÃ­nh toÃ¡n. DÃ²ng 3636-3637, thá»±c hiá»‡n catch táº¥t cáº£ cÃ¡c ngoáº¡i lá»‡ vÃ  nÃ©m ra thÃ´ng bÃ¡o lá»—i -> CÃ³ kháº£ nÄƒng input sáº½ xuáº¥t hiá»‡n thÃ´ng bÃ¡o lá»—i vÃ  cÃ³ thá»ƒ dáº«n Ä‘áº¿n XSS náº¿u Ä‘Æ°á»£c render trá»±c tiáº¿p trÃªn browser.</p>

![alt text](/thanhlai/post/web_exploitation/image/post3/image-3.png)

<p>Thá»­ sá»­ dá»¥ng chuá»—i báº¥t kÃ¬ Ä‘á»ƒ gÃ¢y ra lá»—i thÃ¬ giÃ¡ trá»‹ cá»§a há»‡ sá»‘ B Ä‘Æ°á»£c hiá»ƒn thá»‹ bÃªn trong thÃ´ng bÃ¡o lá»—i.</p>

![alt text](/thanhlai/post/web_exploitation/image/post3/image-5.png)

<p>Tuy nhiÃªn, cÃ¡c kÃ­ tá»± < hoáº·c > Ä‘Ã£ bá»‹ escape -> KhÃ´ng cÃ³ XSS khi render thÃ´ng bÃ¡o lá»—i -> HÆ°á»›ng Ä‘i nÃ y lÃ  fail.</p>

![alt text](/thanhlai/post/web_exploitation/image/post3/image-4.png)

<p>Tiáº¿p tá»¥c, Ä‘i vÃ o hÃ m _calculateFormulaValue thÃ¬ tháº¥y biá»ƒu thá»©c Ä‘Æ°á»£c xá»­ lÃ½ qua khÃ¡ nhiá»u bÆ°á»›c nÃªn phÃ¢n tÃ­ch tá»«ng dÃ²ng code khÃ¡ máº¥t thá»i gian vÃ  cÃ³ thá»ƒ khÃ´ng hiá»‡u quáº£ (táº¡m thá»i Ä‘á»ƒ Ä‘Ã³). Tuy nhiÃªn, khÃ´ng tÃ¬m tháº¥y nÆ¡i cÃ³ dáº¥u hiá»‡u xá»­ lÃ½ Ä‘á»ƒ ngÄƒn cháº·n XSS.</p>

![alt text](/thanhlai/post/web_exploitation/image/post3/image-6.png)

<p>VÃ¬ Calculation.php náº±m trong má»™t dá»± Ã¡n khÃ¡ lÃ  lÃ¢u Ä‘á»i rá»“i nÃªn cháº¯c sáº½ cÃ³ tÃ i liá»‡u Ä‘á»ƒ tham kháº£o. Khi Ä‘á»c sÆ¡ qua: "https://phpspreadsheet.readthedocs.io/en/latest/topics/calculation-engine/" thÃ¬ tháº¥y ráº±ng cÃ¡c biá»ƒu thá»©c tÃ­nh toÃ¡n trong Ä‘Ã¢y Ä‘Æ°á»£c tÃ­nh toÃ¡n vÃ  xá»­ lÃ½ khÃ¡ giá»‘ng Excel. VÃ¬ má»¥c tiÃªu lÃ  chÃ¨n payload xss vÃ o mÃ  biá»ƒu thá»©c váº«n há»£p lá»‡ nÃªn cÃ¢u há»i Ä‘áº·t ra bÃ¢y giá» lÃ  "CÃ³ chá»©c nÄƒng cÃ³ thá»ƒ ná»‘i chuá»—i (payload XSS) vÃ o káº¿t quáº£ sau khi tÃ­nh toÃ¡n khÃ´ng?" (VÃ­ dá»¥: "Káº¿t quáº£ cá»§a 1 + 2 lÃ : 3", trong Ä‘Ã³ 3 lÃ  giÃ¡ trá»‹ sau khi tÃ­nh biá»ƒu thá»©c 1 + 2). Sau khi nhá» Ä‘áº¿n sá»± trá»£ giÃºp cá»§a google thÃ¬ mÃ¬nh tÃ¬m ra má»™t cÃ¡ch khÃ¡ Ä‘Æ¡n giáº£n chá»‰ cáº§n sá»­ dá»¥ng kÃ­ tá»± & Ä‘á»ƒ ná»‘i cÃ¡c chuá»—i láº¡i vá»›i nhau.</p>

<p>Má»¥c tiÃªu bÃ¢y giá» lÃ  ná»‘i dÃ i biá»ƒu thá»©c Ä‘Ã³ ra vÃ  ná»‘i giÃ¡ trá»‹ cá»§a biá»ƒu thá»©c vá»›i chuá»—i "&lt;h1&gt;abc"</p>

![alt text](/thanhlai/post/web_exploitation/image/post3/image-7.png)

<p>ThÃªm 1 kÃ­ tá»± ) váº«n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng.</p>

![alt text](/thanhlai/post/web_exploitation/image/post3/image-8.png)

<p>Thá»­ ná»‘i vá»›i chuá»—i "&lt;h1&gt;abc" thÃ¬ bá»‹ lá»—i. Tuy nhiÃªn, lÃºc nÃ£y dÆ° má»™t kÃ­ tá»± ) váº«n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng nÃªn mÃ¬nh sáº½ thá»­ thÃªm kÃ­ tá»± ).</p>

![alt text](/thanhlai/post/web_exploitation/image/post3/image-9.png)

<p>LÃºc nÃ y, cÃ³ váº» nhÆ° lÃ  sai Ä‘á»‹nh dáº¡ng nhÆ°ng chuá»—i "&lt;h1&gt;abc" váº«n Ä‘Æ°á»£c in ra. ChÃ¨n Ä‘Æ°á»£c html thÃ nh cÃ´ng.</p>

![alt text](/thanhlai/post/web_exploitation/image/post3/image-10.png)

<p>Thay Ä‘á»•i payload thÃ nh `1)&amp;&quot;&lt;script&gt;alert(origin)&lt;/script&gt;&quot;)` -> Trigger XSS thÃ nh cÃ´ng.</p>

![alt text](/thanhlai/post/web_exploitation/image/post3/image-11.png)

<p>TÃ³m láº¡i, Ä‘Ã¢y lÃ  toÃ n bá»™ ná»™i dung vá» challenge. Hy vá»ng writeup nÃ y giÃºp Ã­ch cho báº¡n ğŸ”¥.</p>
